---
title: 젠킨스에 react project 연동하기
date: 2022-01-19 23:38:00 +0900
categories: [blog]
tags: [jenkins, react, nginx]     # TAG names should always be lowercase
---





Jenkins를 이용하여 react project를 자동으로 빌드하고 배포하도록 설정해 보았다.

   

우선 react를 빌드한 후 생성된 웹 페이지를 서비스하기 위한 nginx를 설치한다.

```shell
sudo apt-get update
sudo apt-get install nginx
```

위의 명령어로 간단히 설치할 수 있으며, 

   

```shell
systemctl status nginx
```

명령어로 정상 작동하는지 확인할 수 있다.

​    

웹 브라우저를 이용해 nginx가 설치된 서버의 ip주소로 접속하면,

![nginx_first_contact](/img/a005/nginx_first_contact.png){: .normal}

위와 같은 페이지를 볼 수 있는데, 혹시 연결이 되지 않는다면, ufw 등을 이용하여 방화벽에서 80번 포트가 허용되었는지 확인해 보자.

​    

이제 react app을 create-react-app을 이용하여 생성하고, [젠킨스와 깃헙 연동하기](https://venechi.github.io/posts/a004/) 포스트를 참고하여 세팅을 해 주고,  build 탭에서 'Add build step' -> 'Execute shell'을 눌러 커맨드 입력창을 띄우고, 아래 명령어를 입력한다.

```shell
npm install
sudo nginx -s quit
sudo npm run build
sudo nginx
```

![shell_command](/img/a005/shell_command.png)

   

[nginx beginner's guide](https://nginx.org/en/docs/beginners_guide.html) 에서 명령어들을 확인할 수 있는데,

'-s quit' 옵션은 현재 요청을 처리하고 있는 프로세스들이 요청을 마친 다음 죽을 수 있도록 해 주는 옵션이다.

즉 위의 구문은 현재 요청들을 처리하고, 업데이트된 프로젝트를 빌드한 뒤, 빌드된 프로젝트를 서비스하는 명령어 집합이다.

​    

아직 세팅이 완료되지 않았지만, 만약 해당 프로젝트에 push를 해서 빌드를 발생시켜봤다면, 에러를 볼 수 있는데,

그 이유는, jenkins가 sudo 명령어를 수행할 수 없기 때문이다.

   

이를 해결하기 위해

```shell
sudo visudo
```

를 입력해 권한 설정 파일을 열고 다음 내용을 추가한다.

```shell
jenkins ALL=(ALL) NOPASSWD: ALL
```

![jenkins authority setting](/img/a005/jenkins_authority_setting.png)

   

여기까지 완료되었으면, react앱에 적당한 코드변경을 추가해서, push를 수행한다.

jenkins 아이템 상세정보 창에서 'build history' 탭을 보면 수행한 빌드 기록이 있는데,

하나를 클릭한 뒤 'Console Output' 탭을 누르면,

![build_console_output](/img/a005/build_console_output.png)

위와 같이 경로 정보를 확인할 수 있는데, '{해당 경로}/build' 폴더를 nginx가 서비스할 수 있도록 설정해줘야 한다.

​    

nginx가 설치된 서버에서

```shell
/etc/nginx/sites-enabled
```

로 이동하면 'default'파일이 있는데,

```shell
cp default default.bak
```

명령어로 백업 파일을 만들고 'default' 파일을 vim 등을 이용해 수정한다.

   

다른 것은 건드릴 필요 없고 location 부분만 아래와 같이 변경해 주면 된다.

```shell
location / {
	root {react app build 폴더 경로}
	index index.html index.htm
	try_files $uri /index.html;
}
```

![nginx_setting](/img/a005/nginx_setting.png)

​    

설정을 변경한 뒤, github에 새로운 push를 올리면, 빌드가 자동으로 수행되고, 이후 서버 주소로 브라우저를 통해 접속하면 다음과 같은 화면을 볼 수 있다.

![done](/img/a005/done.png)

​     

연동 완료!
